---
phase: 05-web-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - ui/package.json
  - ui/tsconfig.json
  - ui/vite.config.ts
  - ui/index.html
  - ui/src/main.tsx
  - ui/src/App.tsx
  - ui/src/App.module.css
  - ui/src/lib/api.ts
  - ui/src/lib/queryKeys.ts
  - ui/src/components/Layout.tsx
  - ui/src/components/Layout.module.css
  - ui/src/pages/Providers.tsx
  - ui/src/pages/Chains.tsx
  - ui/src/pages/Dashboard.tsx
  - ui/src/pages/Test.tsx
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "Running 'npm run dev' in ui/ starts Vite dev server with HMR"
    - "Vite dev server proxies /v1/* and /health requests to backend on port 3429"
    - "Browser shows a layout shell with navigation links to Providers, Chains, Dashboard, and Test pages"
    - "Each nav link renders its placeholder page component without full page reload"
    - "API client function includes Authorization header from sessionStorage"
    - "Backend serves ui/dist/ static files and falls back to index.html for SPA routes"
  artifacts:
    - path: "ui/package.json"
      provides: "Frontend project with React 19, Vite, TanStack Query, React Router, React Hook Form, dnd-kit"
    - path: "ui/src/main.tsx"
      provides: "React entry point with QueryClientProvider and RouterProvider"
    - path: "ui/src/lib/api.ts"
      provides: "Centralized fetch wrapper with auth header injection"
      exports: ["api", "setApiKey", "getApiKey"]
    - path: "ui/src/lib/queryKeys.ts"
      provides: "TanStack Query key constants"
      exports: ["queryKeys"]
    - path: "ui/src/components/Layout.tsx"
      provides: "App shell with nav sidebar and content area"
  key_links:
    - from: "ui/src/main.tsx"
      to: "ui/src/pages/*"
      via: "createBrowserRouter route definitions"
      pattern: "createBrowserRouter"
    - from: "ui/src/lib/api.ts"
      to: "/v1/*"
      via: "fetch with Authorization header"
      pattern: "fetch.*v1/"
    - from: "ui/vite.config.ts"
      to: "http://localhost:3429"
      via: "Vite proxy configuration"
      pattern: "proxy.*3429"
    - from: "src/index.ts"
      to: "ui/dist"
      via: "serveStatic middleware"
      pattern: "serveStatic.*ui/dist"
---

<objective>
Scaffold the React SPA frontend project with Vite, set up routing, API client, layout shell, and backend static file serving.

Purpose: This is the shared foundation for all UI pages. It establishes the Vite project, installs all frontend dependencies, configures dev proxy to backend, creates the app shell with navigation, sets up TanStack Query, and wires the Hono backend to serve the built SPA. All subsequent UI plans create page components that plug into this scaffold.

Output: Complete ui/ directory with working Vite project, React Router with all routes declared, API client with auth, layout component, placeholder pages, and backend serveStatic integration.
</objective>

<execution_context>
@C:\Users\danen\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\danen\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-web-ui/05-RESEARCH.md

@src/index.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Vite + React project with all dependencies</name>
  <files>
    ui/package.json
    ui/tsconfig.json
    ui/vite.config.ts
    ui/index.html
    ui/src/main.tsx
    ui/src/App.tsx
    ui/src/App.module.css
  </files>
  <action>
Create the `ui/` directory at project root (sibling to `src/`).

Initialize the Vite project manually (do NOT use `npm create vite` -- create files directly for precise control):

**ui/package.json:**
```json
{
  "name": "429chain-ui",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "preview": "vite preview"
  }
}
```

Install dependencies by running in the ui/ directory:
```bash
cd ui && npm install react@^19.2.4 react-dom@^19.2.4 react-router@^7 @tanstack/react-query@^5 react-hook-form@^7 @hookform/resolvers@^3 zod@^4.3.6 @dnd-kit/core@^6.3.1 @dnd-kit/sortable@^10.0.0 @dnd-kit/utilities
```

And dev dependencies:
```bash
npm install -D @vitejs/plugin-react typescript@^5.9 @types/react@^19 @types/react-dom@^19
```

NOTE: Zod is installed in ui/ so the frontend can share schema validation (e.g., form resolvers). Same version as backend.

**ui/tsconfig.json:**
Standard React + Vite tsconfig:
- `"target": "ES2022"`, `"module": "ESNext"`, `"moduleResolution": "bundler"`
- `"jsx": "react-jsx"`, `"strict": true`, `"skipLibCheck": true`
- `"include": ["src"]`
- Add `"baseUrl": ".", "paths": {}` (no aliases needed, keep it simple)

**ui/vite.config.ts:**
```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    proxy: {
      '/v1': 'http://localhost:3429',
      '/health': 'http://localhost:3429',
    },
  },
  build: {
    outDir: 'dist',
    emptyOutDir: true,
  },
});
```

**ui/index.html:**
Standard Vite SPA shell -- `<div id="root"></div>`, script src `./src/main.tsx`, title "429chain Admin".

**ui/src/main.tsx:**
- Import React, ReactDOM
- Import `createBrowserRouter`, `RouterProvider` from `react-router`
- Import `QueryClient`, `QueryClientProvider` from `@tanstack/react-query`
- Create QueryClient with `defaultOptions.queries.staleTime: 5000, retry: 1`
- Define router with `createBrowserRouter`:
  - `{ path: '/', element: <App />, children: [ ... ] }` -- App is the layout wrapper
  - Children routes: `/` -> `<Dashboard />`, `/providers` -> `<Providers />`, `/chains` -> `<Chains />`, `/test` -> `<Test />`
  - Import page components from `./pages/*`
- Use a layout route pattern: App component renders `<Layout><Outlet /></Layout>`
- Render `<QueryClientProvider><RouterProvider /></QueryClientProvider>` into #root

**ui/src/App.tsx:**
- Import Layout from `./components/Layout`
- Import `Outlet` from `react-router`
- Render `<Layout><Outlet /></Layout>`

**ui/src/App.module.css:** Empty or minimal global resets (box-sizing, font-family: system-ui, margin: 0).

Create minimal placeholder page components (each is ~5 lines returning a heading):
- `ui/src/pages/Providers.tsx` -> `<h1>Providers</h1>`
- `ui/src/pages/Chains.tsx` -> `<h1>Chains</h1>`
- `ui/src/pages/Dashboard.tsx` -> `<h1>Dashboard</h1>`
- `ui/src/pages/Test.tsx` -> `<h1>Test</h1>`
  </action>
  <verify>
Run `cd ui && npm install && npx tsc --noEmit` -- TypeScript compiles. Run `npm run build` in ui/ -- produces ui/dist/ with index.html and assets/.
  </verify>
  <done>
ui/ directory exists with all dependencies installed, Vite builds successfully, TypeScript compiles, router with 4 routes and placeholder pages.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create API client, query keys, layout component, and backend static serving</name>
  <files>
    ui/src/lib/api.ts
    ui/src/lib/queryKeys.ts
    ui/src/components/Layout.tsx
    ui/src/components/Layout.module.css
    src/index.ts
  </files>
  <action>
**ui/src/lib/api.ts:**
Create centralized API client:
- `getApiKey(): string | null` -- reads from `sessionStorage.getItem('429chain-api-key')`
- `setApiKey(key: string): void` -- writes to `sessionStorage.setItem('429chain-api-key', key)`
- `clearApiKey(): void` -- removes from sessionStorage
- `async function apiFetch<T>(path: string, options?: RequestInit): Promise<T>` -- core fetch wrapper:
  - Prepends nothing to path (relative URLs, Vite proxy handles in dev, same-origin in prod)
  - Adds `Authorization: Bearer ${getApiKey()}` header if key exists
  - Adds `Content-Type: application/json` for non-GET requests
  - Calls `fetch(path, options)`
  - If response not ok: parse error JSON `{ error: string }`, throw `new Error(errorJson.error || response.statusText)`
  - If 401: call `clearApiKey()` (force re-auth on next action)
  - Return `response.json()` typed as T
- Export named API functions object:
  ```typescript
  export const api = {
    getConfig: () => apiFetch<{ providers: Provider[], chains: Chain[] }>('/v1/admin/config'),
    putProvider: (id: string, data: any) => apiFetch<{ provider: any }>(`/v1/admin/providers/${id}`, { method: 'PUT', body: JSON.stringify(data) }),
    deleteProvider: (id: string) => apiFetch<{ deleted: string }>(`/v1/admin/providers/${id}`, { method: 'DELETE' }),
    putChain: (name: string, data: any) => apiFetch<{ chain: any }>(`/v1/admin/chains/${name}`, { method: 'PUT', body: JSON.stringify(data) }),
    deleteChain: (name: string) => apiFetch<{ deleted: string }>(`/v1/admin/chains/${name}`, { method: 'DELETE' }),
    getProviderStats: () => apiFetch<{ providers: any[] }>('/v1/stats/providers'),
    getChainStats: () => apiFetch<{ chains: any[] }>('/v1/stats/chains'),
    getRequests: (limit = 50) => apiFetch<{ requests: any[] }>(`/v1/stats/requests?limit=${limit}`),
    getRateLimits: () => apiFetch<{ ratelimits: any[] }>('/v1/ratelimits'),
    getModels: () => apiFetch<{ data: any[] }>('/v1/models'),
    chatCompletion: (body: any) => apiFetch<any>('/v1/chat/completions', { method: 'POST', body: JSON.stringify(body) }),
  };
  ```

**ui/src/lib/queryKeys.ts:**
```typescript
export const queryKeys = {
  config: ['config'] as const,
  providerStats: ['providerStats'] as const,
  chainStats: ['chainStats'] as const,
  requests: (limit: number) => ['requests', limit] as const,
  rateLimits: ['rateLimits'] as const,
  models: ['models'] as const,
};
```

**ui/src/components/Layout.tsx:**
- Sidebar nav with links: Dashboard (/), Providers (/providers), Chains (/chains), Test (/test)
- Use `NavLink` from react-router (adds active class automatically)
- API key input at top of sidebar: a text input + "Set" button that calls `setApiKey(value)`. Show "(set)" indicator if key exists in sessionStorage, "(not set)" if not. Use `useState` to track this.
- Main content area renders `{children}` (the Outlet from App.tsx)
- Style with CSS Modules (Layout.module.css)

**ui/src/components/Layout.module.css:**
- Flexbox layout: sidebar (250px fixed) + main content (flex: 1)
- Sidebar: dark background (#1a1a2e or similar), light text, full height (min-height: 100vh)
- Nav links: block display, padding, hover highlight, active state with left border accent
- Main content: padding 24px, background #fafafa
- API key section at top of sidebar with compact input styling
- Keep styling functional, not fancy -- admin dashboard aesthetic

**Update src/index.ts (backend):**
Add static file serving AFTER all API routes but BEFORE any catch-all:

```typescript
import { serveStatic } from '@hono/node-server/serve-static';

// ... existing route setup ...

app.route('/v1', v1);

// Serve frontend static assets (JS, CSS, images from Vite build)
app.use('/assets/*', serveStatic({ root: './ui/dist' }));

// SPA fallback: serve index.html for all non-API routes
// This MUST come after API routes to avoid catching /v1/* or /health paths
app.get('*', async (c, next) => {
  // Let API paths fall through to 404
  if (c.req.path.startsWith('/v1/') || c.req.path.startsWith('/health')) {
    return next();
  }
  return serveStatic({ path: './ui/dist/index.html' })(c, next);
});
```

Also serve other common static files (favicon, etc.):
```typescript
app.use('/favicon.ico', serveStatic({ path: './ui/dist/favicon.ico' }));
app.use('/vite.svg', serveStatic({ path: './ui/dist/vite.svg' }));
```

Note: `@hono/node-server` already includes `serveStatic` -- no new dependency needed.
  </action>
  <verify>
Run `cd ui && npx tsc --noEmit` -- frontend TypeScript compiles. Run `cd .. && npx tsc --noEmit` -- backend TypeScript still compiles. Run `cd ui && npm run build` to produce ui/dist/. Verify ui/dist/index.html exists and ui/dist/assets/ contains JS/CSS bundles.
  </verify>
  <done>
API client with auth header injection exists, query keys are defined, Layout component renders sidebar nav with API key input and content area, backend serves ui/dist/ with SPA fallback, Vite dev proxy configured for /v1/* and /health.
  </done>
</task>

</tasks>

<verification>
1. `cd ui && npm run build` produces ui/dist/ with index.html + assets/
2. `cd ui && npx tsc --noEmit` passes
3. `npx tsc --noEmit` (backend) passes
4. Layout component has nav links to all 4 pages
5. API client includes Authorization header from sessionStorage
6. Vite config proxies /v1 and /health to localhost:3429
7. Backend index.ts serves static files and has SPA fallback
</verification>

<success_criteria>
- ui/ directory is a self-contained Vite + React 19 + TypeScript project
- All frontend dependencies installed (react-router, tanstack-query, react-hook-form, dnd-kit, zod)
- Router has 4 declared routes with placeholder page components
- Layout shell renders with sidebar nav and main content area
- API client handles auth, errors, and provides typed fetch wrappers for all endpoints
- Backend serves ui/dist/ static files and falls back to index.html for client-side routes
- Vite dev proxy forwards /v1/* to backend during development
</success_criteria>

<output>
After completion, create `.planning/phases/05-web-ui/05-02-SUMMARY.md`
</output>
