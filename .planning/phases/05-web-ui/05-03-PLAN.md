---
phase: 05-web-ui
plan: 03
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified:
  - ui/src/pages/Providers.tsx
  - ui/src/pages/Providers.module.css
  - ui/src/components/ProviderForm.tsx
  - ui/src/components/ProviderForm.module.css
autonomous: true

must_haves:
  truths:
    - "User sees a list of configured providers with name, type, and masked API key"
    - "User can click 'Add Provider' to open a form with id, name, type, apiKey, baseUrl fields"
    - "Form validates input with Zod (matching backend ProviderSchema) and shows field-level errors"
    - "Submitting a valid provider adds it to the list without page reload"
    - "User can delete a provider from the list with a confirmation step"
    - "Server validation errors (e.g., duplicate id, provider in use) display in the form"
  artifacts:
    - path: "ui/src/pages/Providers.tsx"
      provides: "Provider list page with add/delete functionality"
      min_lines: 50
    - path: "ui/src/components/ProviderForm.tsx"
      provides: "Provider add/edit form with React Hook Form + Zod validation"
      min_lines: 60
  key_links:
    - from: "ui/src/pages/Providers.tsx"
      to: "/v1/admin/config"
      via: "TanStack Query useQuery for provider list"
      pattern: "useQuery.*config"
    - from: "ui/src/components/ProviderForm.tsx"
      to: "/v1/admin/providers"
      via: "TanStack Query useMutation for PUT provider"
      pattern: "useMutation.*putProvider"
    - from: "ui/src/pages/Providers.tsx"
      to: "ui/src/lib/queryKeys.ts"
      via: "query invalidation after mutations"
      pattern: "invalidateQueries.*config"
---

<objective>
Build the provider management page where users can view, add, and delete providers through the UI.

Purpose: Fulfills requirement WEBU-01 (Provider management -- add/remove providers with API keys, view available models per provider). Users should be able to manage providers without editing the YAML config file.

Output: Providers page component and ProviderForm component with full CRUD functionality.
</objective>

<execution_context>
@C:\Users\danen\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\danen\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/05-web-ui/05-01-SUMMARY.md
@.planning/phases/05-web-ui/05-02-SUMMARY.md

@ui/src/lib/api.ts
@ui/src/lib/queryKeys.ts
@src/config/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create provider list page with delete functionality</name>
  <files>
    ui/src/pages/Providers.tsx
    ui/src/pages/Providers.module.css
  </files>
  <action>
Replace the placeholder Providers page with a full implementation:

**ui/src/pages/Providers.tsx:**
- Use `useQuery` with `queryKeys.config` and `api.getConfig` to fetch the provider list.
- Display providers in a table or card list showing: id, name, type, apiKey (masked as "***"), baseUrl (or "default").
- Show loading spinner/text while fetching, error message on failure.
- "Add Provider" button at top that toggles showing the ProviderForm component (use `useState<boolean>` to control visibility).
- Each provider row has a "Delete" button.
- Delete button: first click changes text to "Confirm?" (use local state per-row). Second click fires `useMutation` calling `api.deleteProvider(id)` with `onSuccess: () => queryClient.invalidateQueries({ queryKey: queryKeys.config })`.
- If delete mutation returns an error (e.g., provider in use by chains), display the error message inline next to that row.
- When ProviderForm submits successfully, hide the form and the list refreshes (via query invalidation).

**ui/src/pages/Providers.module.css:**
- Table styling: full width, border-collapse, alternating row colors
- Provider type as a badge/pill (colored by type)
- Delete button: red text, changes to red background on confirm state
- Add button: primary color, positioned top-right
- Responsive: on narrow screens, switch from table to stacked cards
  </action>
  <verify>
Run `cd ui && npx tsc --noEmit` -- TypeScript compiles without errors.
  </verify>
  <done>
Provider list page displays all providers from config, supports delete with confirmation, and shows/hides the add provider form.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create provider add/edit form with Zod validation</name>
  <files>
    ui/src/components/ProviderForm.tsx
    ui/src/components/ProviderForm.module.css
  </files>
  <action>
**ui/src/components/ProviderForm.tsx:**
- Use `react-hook-form` with `zodResolver` for form state and validation.
- Define a frontend Zod schema for the provider form (replicate ProviderSchema from backend but as a standalone definition -- do NOT import from src/config/schema.ts since that's backend code, the frontend has its own zod):
  ```typescript
  const providerFormSchema = z.object({
    id: z.string().min(1, 'Provider ID is required'),
    name: z.string().min(1, 'Provider name is required'),
    type: z.enum(['openrouter', 'groq', 'cerebras', 'generic-openai']),
    apiKey: z.string().min(1, 'API key is required'),
    baseUrl: z.string().url('Must be a valid URL').optional().or(z.literal('')),
  });
  ```
- Form fields:
  - **id**: text input (disabled if editing existing provider)
  - **name**: text input
  - **type**: select dropdown with options: openrouter, groq, cerebras, generic-openai
  - **apiKey**: password-type input with show/hide toggle
  - **baseUrl**: text input (optional, show hint "Required for generic-openai")
- Each field shows its validation error below the input (from `formState.errors`).
- Submit handler: calls `useMutation` with `api.putProvider(data.id, data)`.
  - On success: call `queryClient.invalidateQueries({ queryKey: queryKeys.config })`, call `onSuccess` prop (parent hides form).
  - On error: display server error message at top of form (from mutation.error.message).
- Props: `onSuccess: () => void` (callback to close form), `onCancel: () => void` (callback to hide form).
- Cancel button next to submit.

**ui/src/components/ProviderForm.module.css:**
- Form layout: stacked fields (label + input + error)
- Input styling: full width, border, padding, focus ring
- Error text: red, small font
- Button row: flex, gap, submit button primary color, cancel button secondary
- Form container: card-like with padding, subtle border/shadow
  </action>
  <verify>
Run `cd ui && npx tsc --noEmit` -- TypeScript compiles. Run `cd ui && npm run build` -- production build succeeds.
  </verify>
  <done>
Provider form validates all fields with Zod, submits to admin API, displays both client and server validation errors, and notifies parent on success/cancel.
  </done>
</task>

</tasks>

<verification>
1. `cd ui && npm run build` succeeds
2. `cd ui && npx tsc --noEmit` passes
3. Provider list displays data from /v1/admin/config
4. Add Provider form validates with Zod before submitting
5. Delete has two-click confirmation pattern
6. Query invalidation refreshes list after mutations
</verification>

<success_criteria>
- Provider list shows id, name, type, masked apiKey for all configured providers
- Add Provider form has all fields (id, name, type, apiKey, baseUrl) with validation
- Form shows field-level validation errors from Zod
- Form shows server-side errors from failed mutations
- Delete requires confirmation click before executing
- List refreshes automatically after add or delete
</success_criteria>

<output>
After completion, create `.planning/phases/05-web-ui/05-03-SUMMARY.md`
</output>
