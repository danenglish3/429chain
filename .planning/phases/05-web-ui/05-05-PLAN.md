---
phase: 05-web-ui
plan: 05
type: execute
wave: 2
depends_on: ["05-02"]
files_modified:
  - ui/src/pages/Dashboard.tsx
  - ui/src/pages/Dashboard.module.css
  - ui/src/components/StatsCard.tsx
  - ui/src/components/StatsCard.module.css
  - ui/src/components/RequestLog.tsx
  - ui/src/components/RequestLog.module.css
  - ui/src/components/RateLimitStatus.tsx
  - ui/src/components/RateLimitStatus.module.css
autonomous: true

must_haves:
  truths:
    - "User sees per-provider usage totals (total requests, total tokens) on the dashboard"
    - "User sees per-chain usage totals on the dashboard"
    - "User sees a scrollable list of recent requests with provider, model, tokens, latency, status"
    - "User sees live rate limit status for each provider+model pair, updating every 5 seconds"
    - "Rate limit status shows available/tracking/exhausted state with cooldown timers"
  artifacts:
    - path: "ui/src/pages/Dashboard.tsx"
      provides: "Usage dashboard page composing stats, logs, and rate limits"
      min_lines: 40
    - path: "ui/src/components/RequestLog.tsx"
      provides: "Scrollable recent request log table"
      min_lines: 40
    - path: "ui/src/components/RateLimitStatus.tsx"
      provides: "Live rate limit status display with auto-refresh"
      min_lines: 40
  key_links:
    - from: "ui/src/pages/Dashboard.tsx"
      to: "/v1/stats/providers"
      via: "useQuery for provider stats"
      pattern: "useQuery.*providerStats"
    - from: "ui/src/components/RequestLog.tsx"
      to: "/v1/stats/requests"
      via: "useQuery for recent requests"
      pattern: "useQuery.*requests"
    - from: "ui/src/components/RateLimitStatus.tsx"
      to: "/v1/ratelimits"
      via: "useQuery with refetchInterval: 5000"
      pattern: "refetchInterval.*5000"
---

<objective>
Build the usage dashboard page showing per-provider totals, per-chain totals, scrollable request log, and live rate limit status.

Purpose: Fulfills requirement WEBU-03 (Usage dashboard -- per-provider totals, per-chain totals, scrollable request log, live rate limit status display). Users can monitor proxy activity and rate limit state without CLI tools or direct API calls.

Output: Dashboard page with StatsCard, RequestLog, and RateLimitStatus components.
</objective>

<execution_context>
@C:\Users\danen\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\danen\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/05-web-ui/05-02-SUMMARY.md

@ui/src/lib/api.ts
@ui/src/lib/queryKeys.ts
@src/api/routes/stats.ts
@src/api/routes/ratelimits.ts
@src/persistence/aggregator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create stats cards and dashboard layout</name>
  <files>
    ui/src/pages/Dashboard.tsx
    ui/src/pages/Dashboard.module.css
    ui/src/components/StatsCard.tsx
    ui/src/components/StatsCard.module.css
  </files>
  <action>
**ui/src/components/StatsCard.tsx:**
Simple reusable card component for displaying a stat.
Props: `title: string`, `value: string | number`, `subtitle?: string`.
Renders: title (small text), value (large text), subtitle (small muted text).
Style with CSS Modules (StatsCard.module.css): card with padding, subtle border, rounded corners.

**ui/src/pages/Dashboard.tsx:**
Composes three sections in a grid layout:

**Section 1: Usage Summary (top row)**
- Fetch provider stats: `useQuery({ queryKey: queryKeys.providerStats, queryFn: api.getProviderStats })`
- Fetch chain stats: `useQuery({ queryKey: queryKeys.chainStats, queryFn: api.getChainStats })`
- Display StatsCards in a grid:
  - Provider cards: one card per provider showing name, total requests, total tokens. Format tokens with comma separators (e.g., 1,234,567).
  - Chain cards: one card per chain showing name, total requests, total tokens.
- Handle loading/error states.
- If no stats data yet (empty arrays), show "No usage data yet" message.

**Section 2: Request Log (middle row)**
- Render `<RequestLog />` component (created in Task 2).

**Section 3: Rate Limit Status (bottom row)**
- Render `<RateLimitStatus />` component (created in Task 2).

**ui/src/pages/Dashboard.module.css:**
- Three-section vertical layout with spacing between sections
- Stats grid: CSS Grid with auto-fill, minmax(200px, 1fr) for responsive cards
- Each section has a heading (h2)
- Provider stats and chain stats in separate groups
  </action>
  <verify>
Run `cd ui && npx tsc --noEmit` -- TypeScript compiles.
  </verify>
  <done>
Dashboard page renders usage summary cards for providers and chains, and mounts RequestLog and RateLimitStatus components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create request log and rate limit status components</name>
  <files>
    ui/src/components/RequestLog.tsx
    ui/src/components/RequestLog.module.css
    ui/src/components/RateLimitStatus.tsx
    ui/src/components/RateLimitStatus.module.css
  </files>
  <action>
**ui/src/components/RequestLog.tsx:**
- Fetch recent requests: `useQuery({ queryKey: queryKeys.requests(100), queryFn: () => api.getRequests(100) })`
- Display in a scrollable table (max-height ~400px with overflow-y: auto)
- Table columns: Time (formatted from timestamp, e.g., "12:34:56" or relative "2m ago"), Chain, Provider, Model, Tokens (total), Latency (ms), Status (HTTP code)
- Format timestamp: use `new Date(timestamp).toLocaleTimeString()` for simplicity
- Format latency: round to integer + "ms"
- Color-code HTTP status: 200 green, 4xx yellow, 5xx red
- Handle empty state: "No requests logged yet"
- Handle loading/error states

**ui/src/components/RequestLog.module.css:**
- Table: full width, compact rows, fixed header (sticky top)
- Scrollable container: max-height 400px, overflow-y auto
- Status cell: colored badge (green/yellow/red)
- Alternating row colors for readability
- Monospace font for numbers (latency, tokens)

**ui/src/components/RateLimitStatus.tsx:**
- Fetch rate limits with live refresh: `useQuery({ queryKey: queryKeys.rateLimits, queryFn: api.getRateLimits, refetchInterval: 5000 })`
- Display each provider+model pair as a row or card:
  - Provider name + model
  - Status badge: "available" (green), "tracking" (blue), "exhausted" (red)
  - If exhausted: show cooldown timer ("Cooldown until HH:MM:SS" or "Xm Xs remaining")
  - If tracking with quota: show remaining requests and remaining tokens
  - If quota has resetRequestsMs/resetTokensMs: show "Resets in Xm"
- Handle empty state: "No rate limit data (no requests made yet)"
- Show last updated time: "Updated X seconds ago" based on when the query last fetched

**ui/src/components/RateLimitStatus.module.css:**
- Grid or table layout for rate limit entries
- Status badges: colored pills (green=available, blue=tracking, red=exhausted)
- Cooldown timers: monospace, red text
- Quota bars or text showing remaining/total
- Compact layout -- this can get long with many provider+model pairs
  </action>
  <verify>
Run `cd ui && npx tsc --noEmit` -- TypeScript compiles. Run `cd ui && npm run build` -- production build succeeds.
  </verify>
  <done>
Request log displays recent requests in a scrollable table with formatted timestamps, latency, and color-coded status. Rate limit status shows live per-provider+model state with 5-second auto-refresh, cooldown timers, and quota remaining.
  </done>
</task>

</tasks>

<verification>
1. `cd ui && npm run build` succeeds
2. `cd ui && npx tsc --noEmit` passes
3. Dashboard renders provider and chain stats cards
4. Request log table is scrollable with formatted data
5. Rate limit status uses refetchInterval: 5000 for live updates
6. All components handle loading/error/empty states
</verification>

<success_criteria>
- Per-provider stats cards show total requests and total tokens
- Per-chain stats cards show total requests and total tokens
- Request log shows last 100 requests in scrollable table with time, chain, provider, model, tokens, latency, status
- Rate limit status shows all provider+model pairs with status badges (available/tracking/exhausted)
- Rate limit display auto-refreshes every 5 seconds
- Exhausted entries show cooldown timer
- Tracking entries show remaining quota
</success_criteria>

<output>
After completion, create `.planning/phases/05-web-ui/05-05-SUMMARY.md`
</output>
